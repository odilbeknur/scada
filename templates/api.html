<!doctype html>
<html lang="en">
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- Bootstrap CSS -->
        <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
          <title>Consume Rest Api</title>
          <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
          <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    </head>
    <body>
        <div class="container-fluid p-2 bg-primary text-white text-center">
            <h1>Plants</h1>
        </div>
        <div class="container mt-5">
            <table class="table">
                <thead>
                    <tr>
                        <th>Id</th>
                        <th>Plants</th>
                        <th>Soil</th>
                        <th>Soil</th>
                    </tr>
                </thead>
                <tbody>
                    {% for name in names %}
                    <tr>
                        <td>{{ name.plant_id }}</td>
                        <td>{{ name.name }}</td>                        
                        <td>{{ name.pin_soil }}</td>
                        <td>{{ name.capacity }}</td>
                    </tr>
                    {% endfor %}    
                </tbody>
            </table>

            <form method="post" id="waterForm">
              {% csrf_token %}
                <div class="form-group">
                    <label for="customRange3" class="form-label">Choose plant</label> 
                    <select class="form-select" aria-label="Default select example" name="plant">
                        <option selected>Open this select menu</option>
                        {% for name in names %}
                            <option value="{{ name.num_p }}">{{ name.name }}</option>
                        {% endfor %}
                      </select>
                </div>
                <div class="form-group pt-10" style="padding-top:10px;">
                    <label for="customRange3" class="form-label">Water amount (ml)</label> 
                    <input name="amount" type="range" class="form-range" min="1" max="10000" step="1" id="customRange3" oninput="this.nextElementSibling.value = this.value">
                    <output></output>
                </div>
                <button type="submit" class="btn btn-primary">Pour</button>
              </form>
       </div>
       
    </body>
    <script>
      document.getElementById('waterForm').addEventListener('submit', function(event) {
          event.preventDefault();  // Prevent default form submission

          // Get form data
          const formData = new FormData(this);

          // Send POST request using Axios
          axios.post('/watering/', formData)
              .then(response => {
                  if (response.data.success) {
                      // Handle success
                      alert('Watering successful!');
                  } else {
                      // Handle failure
                      alert('Watering failed!');
                  }
              })
              .catch(error => {
                  console.error('Error:', error);
                  alert('An error occurred while watering.');
              });
        });


        function refreshPlantData() {
          fetch('/api/')
              .then(response => response.json())
              .then(data => {
                  updatePlantTable(data);
              })
              .catch(error => {
                  console.error('Error:', error);
        });
}

        function updatePlantTable(data) {
            const tableBody = document.getElementById('plant-table-body');
            tableBody.innerHTML = ''; 

            data.forEach(plant => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${plant.plant_id}</td>
                    <td>${plant.name}</td>
                    <td>${plant.pin_soil}</td>
                    <td>${plant.capacity}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        // Call refreshPlantData when the page loads
        document.addEventListener('DOMContentLoaded', () => {
            refreshPlantData();
        });



    </script>

<style>
    .switch {
      position: relative;
      display: inline-block;
      width: 60px;
      height: 34px;
    }
    
    .switch input { 
      opacity: 0;
      width: 0;
      height: 0;
    }
    
    .slider {
      position: absolute;
      cursor: pointer;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: #ccc;
      -webkit-transition: .4s;
      transition: .4s;
    }
    
    .slider:before {
      position: absolute;
      content: "";
      height: 26px;
      width: 26px;
      left: 4px;
      bottom: 4px;
      background-color: white;
      -webkit-transition: .4s;
      transition: .4s;
    }
    
    input:checked + .slider {
      background-color: #2196F3;
    }
    
    input:focus + .slider {
      box-shadow: 0 0 1px #2196F3;
    }
    
    input:checked + .slider:before {
      -webkit-transform: translateX(26px);
      -ms-transform: translateX(26px);
      transform: translateX(26px);
    }
    
    /* Rounded sliders */
    .slider.round {
      border-radius: 34px;
    }
    
    .slider.round:before {
      border-radius: 50%;
    }
    </style>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</html>