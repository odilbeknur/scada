{% load static %}
<!DOCTYPE html>

<html
  lang="en"
  class="light-style layout-menu-fixed layout-compact"
  dir="ltr"
  data-theme="theme-default"
  data-template="vertical-menu-template-free">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />

    <title>Plant SCADA</title>

    <meta name="description" content="" />

    <!-- Favicon -->

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&ampdisplay=swap"
      rel="stylesheet" />

    <link rel="stylesheet" href="{% static 'admin/vendor/fonts/materialdesignicons.css' %}" />


    <!-- Core CSS -->
    <link rel="stylesheet" href="{% static 'admin/vendor/css/core.css' %}" class="template-customizer-core-css" />
    <link rel="stylesheet" href="{% static 'admin/vendor/css/theme-default.css' %}" class="template-customizer-theme-css" />
    <link rel="stylesheet" href="{% static 'admin/css/demo.css' %}" />
    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>

    <!-- Helpers -->
    <script src="{% static 'admin/vendor/js/helpers.js' %}"></script>
    <!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->
    <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->
    <script src="{% static 'admin/js/config.js' %}"></script>
  </head>

  <body>
    <!-- Layout wrapper -->
    <div class="layout-wrapper layout-content-navbar">
      <div class="layout-container">
        <!-- Menu -->

        <aside id="layout-menu" class="layout-menu menu-vertical menu bg-menu-theme">
          <div class="app-brand demo">
            <a href="index.html" class="app-brand-link">
              <span class="app-brand-logo demo me-1">
                <span style="color: var(--bs-primary)">
                 
                </span>
              </span>
              <span class="app-brand-text demo menu-text fw-semibold ms-2" style="color:#3ed89d">PLANTS CONTROL</span>
            </a>

            <a href="javascript:void(0);" class="layout-menu-toggle menu-link text-large ms-auto">
              <i class="mdi menu-toggle-icon d-xl-block align-middle mdi-20px"></i>
            </a>
          </div>

          <div class="menu-inner-shadow"></div>

          <ul class="menu-inner py-1">
            <!-- Dashboards -->
            <li class="menu-item active">
              <a href="{% url 'admin-index'%}" class="menu-link">
                <i class="menu-icon tf-icons mdi mdi-view-dashboard-variant"></i>
                <div>Панель</div>
              </a>             
            </li>

            

            <!-- Forms & Tables -->
            <li class="menu-header fw-medium mt-4"><span class="menu-header-text">Растения и Устройства</span></li>
            <!-- Form Validation -->
            <li class="menu-item">
              <a href="{% url 'admin-plants'%}" target="_blank" class="menu-link">
                <i class="menu-icon tf-icons mdi mdi-sprout"></i>
                <div data-i18n="Form Validation">Растения</div>
                <div class="badge bg-label-primary fs-tiny rounded-pill ms-auto">5</div>
              </a>
            </li>
            <!-- Data Tables -->
            <li class="menu-item">
              <a href="#" target="_blank" class="menu-link">
                <i class="menu-icon tf-icons mdi mdi-grid"></i>
                <div data-i18n="Datatables">Устройства</div>
                <div class="badge bg-label-primary fs-tiny rounded-pill ms-auto">5</div>
              </a>
            </li>
            <!-- Misc -->
            <li class="menu-header fw-medium mt-4"><span class="menu-header-text">Создание объекта</span></li>
            <li class="menu-item">
              <a
                href="{% url 'plant-create'%}"
                target="_blank"
                class="menu-link">
                <i class="menu-icon tf-icons mdi mdi-seed-plus-outline"></i>
                <div>Добавить растение</div>
              </a>
            </li>
            <li class="menu-item">
              <a
                href="{% url 'category-create' %}"
                target="_blank"
                class="menu-link">
                <i class="menu-icon tf-icons mdi mdi-plus-box"></i>
                <div>Добавить комнату</div>
              </a>
            </li>
            <li class="menu-item">
              <a
                href="{% url 'responsible-create' %}"
                target="_blank"
                class="menu-link">
                <i class="menu-icon tf-icons mdi mdi-account-plus"></i>
                <div>Добавить ответственного</div>
              </a>
            </li>
          </ul>
        </aside>
        <!-- / Menu -->

        <!-- Layout container -->
        <div class="layout-page">
          <!-- Navbar -->

          <nav
            class="layout-navbar container-xxl navbar navbar-expand-xl navbar-detached align-items-center bg-navbar-theme"
            id="layout-navbar">
            <div class="layout-menu-toggle navbar-nav align-items-xl-center me-3 me-xl-0 d-xl-none">
              <a class="nav-item nav-link px-0 me-xl-4" href="javascript:void(0)">
                <i class="mdi mdi-menu mdi-24px"></i>
              </a>
            </div>

            <div class="navbar-nav-right d-flex align-items-center" id="navbar-collapse">
              <!-- Search -->
              <div class="navbar-nav align-items-center">
                <div class="nav-item d-flex align-items-center">
                  <i class="mdi mdi-magnify mdi-24px lh-0"></i>
                  <input
                    type="text"
                    class="form-control border-0 shadow-none bg-body"
                    placeholder="Search..."
                    aria-label="Search..." />
                </div>
              </div>
              <!-- /Search -->

              <ul class="navbar-nav flex-row align-items-center ms-auto">

                <!-- User -->
                <li class="nav-item navbar-dropdown dropdown-user dropdown">
                  <a
                    class="nav-link dropdown-toggle hide-arrow p-0"
                    href="javascript:void(0);"
                    data-bs-toggle="dropdown">
                    <div class="avatar avatar-online">
                      <img src="{% static 'admin/img/avatars/face.jpg' %}" alt class="w-px-40 h-auto rounded-circle" />
                    </div>
                  </a>
                  <ul class="dropdown-menu dropdown-menu-end mt-3 py-2">
                    <li>
                      <a class="dropdown-item pb-2 mb-1" href="#">
                        <div class="d-flex align-items-center">
                          <div class="flex-shrink-0 me-2 pe-1">
                            <div class="avatar avatar-online">
                              <img src="{% static 'admin/img/avatars/face.jpg'%}" alt class="w-px-40 h-auto rounded-circle" />
                            </div>
                          </div>
                          <div class="flex-grow-1">
                            <h6 class="mb-0">Администратор</h6>
                            <small class="text-muted">Админ</small>
                          </div>
                        </div>
                      </a>
                    </li>
                    <li>
                      <div class="dropdown-divider my-1"></div>
                    </li>
                    <li>
                      <a class="dropdown-item" href="#">
                        <i class="mdi mdi-account-outline me-1 mdi-20px"></i>
                        <span class="align-middle">Мой профиль</span>
                      </a>
                    </li>
                    <li>
                      <a class="dropdown-item" href="#">
                        <i class="mdi mdi-cog-outline me-1 mdi-20px"></i>
                        <span class="align-middle">Настройки</span>
                      </a>
                    </li>
                    <li>
                      <div class="dropdown-divider my-1"></div>
                    </li>
                    <li>
                      <a class="dropdown-item" href="javascript:void(0);">
                        <i class="mdi mdi-power me-1 mdi-20px"></i>
                        <span class="align-middle">Выйти</span>
                      </a>
                    </li>
                  </ul>
                </li>
                <!--/ User -->
              </ul>
            </div>
          </nav>

          <!-- / Navbar -->

           <!-- Content wrapper -->
           <div class="content-wrapper">
            <!-- Content -->

            <div class="container-xxl flex-grow-1 container-p-y">
              <div class="row gy-4">
                {% for m in query %}
                <!-- Congratulations card -->
                <div class="col-md-12 col-lg-4">
                  <div class="card">
                    <div class="card-body">
                      <h4 class="card-title mb-1">{{ m.plant_name }}</h4>
                      <p class="pb-0">{{ m.description }}</p>
                      <h4 class="text-primary mb-1">{{ m.soil_value }}%</h4>
                      <p class="mb-2 pb-1"> Объем воды - {{ m.capacity }} мл</p>
                      <a href="{% url 'product-detail' pk=m.id %}" class="btn btn-sm btn-primary">Подробнее</a>
                    </div>
                    <img
                      src="{{m.plant_image.url}}"
                      class="scaleX-n1-rtl position-absolute bottom-0 end-0 me-4 mb-4 pb-2"
                      width="120"
                      alt="view sales" />
                  </div>
                </div>
                <!--/ Congratulations card -->


                <!-- Transactions -->
                <div class="col-lg-8">
                  <div class="card">
                    <div class="card-header">
                      <div class="d-flex align-items-center justify-content-between">
                        <h5 class="card-title m-0 me-2">Состояние пинов</h5>
                        <div class="dropdown">
                          <button
                            class="btn p-0"
                            type="button"
                            id="transactionID"
                            data-bs-toggle="dropdown"
                            aria-haspopup="true"
                            aria-expanded="false">
                            <i class="mdi mdi-dots-vertical mdi-24px"></i>
                          </button>
                          <div class="dropdown-menu dropdown-menu-end" aria-labelledby="transactionID">
                            <a class="dropdown-item" href="javascript:void(0);">Обновить</a>
                            <a class="dropdown-item" href="javascript:void(0);">Изменить</a>
                            <a class="dropdown-item" href="javascript:void(0);">Удалить</a>
                          </div>
                        </div>
                      </div>
                      <p class="mt-3"><span class="fw-medium"></span> </p>
                    </div>
                    <div class="card-body">
                      <div class="row g-3">
                        <div class="col-md-3 col-6">
                          <div class="d-flex align-items-center">
                            <div class="avatar">
                              <div class="avatar-initial bg-warning rounded shadow">
                                <i class="mdi mdi-gamepad-circle mdi-24px"></i>
                              </div>
                            </div>
                            <div class="ms-3">
                              <div class="small mb-1">Пин 1</div>
                              <h5 class="mb-0">Плохая связь</h5>
                            </div>
                          </div>
                        </div>
                        <div class="col-md-3 col-6">
                          <div class="d-flex align-items-center">
                            <div class="avatar">
                              <div class="avatar-initial bg-success rounded shadow">
                                <i class="mdi mdi-gamepad-circle mdi-24px"></i>
                              </div>
                            </div>
                            <div class="ms-3">
                              <div class="small mb-1">Пин 2</div>
                              <h5 class="mb-0">Подключено</h5>
                            </div>
                          </div>
                        </div>
                        <div class="col-md-3 col-6">
                          <div class="d-flex align-items-center">
                            <div class="avatar">
                              <div class="avatar-initial bg-success rounded shadow">
                                <i class="mdi mdi-gamepad-circle mdi-24px"></i>
                              </div>
                            </div>
                            <div class="ms-3">
                              <div class="small mb-1">Пин 3</div>
                              <h5 class="mb-0">Подключено</h5>
                            </div>
                          </div>
                        </div>
                        <div class="col-md-3 col-6">
                          <div class="d-flex align-items-center">
                            <div class="avatar">
                              <div class="avatar-initial bg-danger rounded shadow">
                                <i class="mdi mdi-gamepad-circle mdi-24px"></i>
                              </div>
                            </div>
                            <div class="ms-3">
                              <div class="small mb-1">Пин 4</div>
                              <h5 class="mb-0">Отключено</h5>
                            </div>
                          </div>
                        </div>
                        <br><br><br><br>
                      </div>
                    </div>
                  </div>
                </div>
                <!--/ Transactions -->

                <!-- Weekly Overview Chart -->
                <div class="col-xl-4 col-md-6">
                  <div class="card">
                    <div class="card-header">
                      <div class="d-flex justify-content-between">
                        <h5 class="mb-1">Недельный обзор</h5>
                      </div>
                    </div>
                    <div class="card-body">
                      <div id="weeklyOverviewChart"></div>
                      <div class="mt-1 mt-md-3">
                        <div class="d-flex align-items-center gap-3">
                          <h3 class="mb-0">{{ m.soil_value }}%</h3>
                          <p class="mb-0">Максимальная влажность на этой неделе </p>
                        </div>
                        <div class="d-grid mt-3 mt-md-4">
                          <button class="btn btn-primary" type="button">Детали</button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
                <!--/ Weekly Overview Chart -->

                <!-- Total Earnings -->
                <div class="col-xl-8 col-md-6">
                  <div class="card">
                    <div class="card-header d-flex align-items-center justify-content-between">
                      <h5 class="card-title m-0 me-2">Полив растения - номер пина №{{ m.plant_num }}</h5>
                      <div class="dropdown">
                        <button
                          class="btn p-0"
                          type="button"
                          id="totalEarnings"
                          data-bs-toggle="dropdown"
                          aria-haspopup="true"
                          aria-expanded="false">
                          <i class="mdi mdi-dots-vertical mdi-24px"></i>
                        </button>
                        <div class="dropdown-menu dropdown-menu-end" aria-labelledby="totalEarnings">
                          <a class="dropdown-item" href="">Обновить</a>
                          <a class="dropdown-item" href="">Изменить</a>
                          <a class="dropdown-item" href="">Удалить</a>
                        </div>
                      </div>
                    </div>
                    <div class="card-body" method="post" enctype="multipart/form-data">
                      <form method="post" id="waterForm" enctype="multipart/form-data">
                        {% csrf_token %}
                        <div class="form-floating form-floating-outline mb-4">
                          <input name="plant"  type="hidden" value="{{ m.plant_num }}">
                        </div>
                        <div class="container">
                          <div class="tank">
                              <div class="water" id="water"></div>
                              <div class="water-level" id="waterLevel">10 литров</div>
                          </div>
                  
                          <!-- Water level input positioned under the water tank -->
                          <input name="amount" type="range" step="1" min="1" max="500" value="10000" id="waterLevelInput" oninput="setWaterLevel(this.value)">
                        </div>
                        <output></output>

                        <!--<div class="mb-4">
                          <label for="formFile" class="form-label">Фото</label>
                          <input name="image" class="form-control" type="file" id="formFile">
                        </div>-->
                        <button type="submit" class="btn btn-primary">Полить</button>
                      </form>
                    </div>
                  </div>
                </div>

              </div>
            </div>
            <!-- / Content -->

            {% endfor %}



            <div class="content-backdrop fade"></div>
          </div>
          <!-- Content wrapper -->
        </div>
        <!-- / Layout page -->
      </div>

      <!-- Overlay -->
      <div class="layout-overlay layout-menu-toggle"></div>
    </div>
    <!-- / Layout wrapper -->
    <script>
      document.getElementById('waterForm').addEventListener('submit', function(event) {
          event.preventDefault();  // Prevent default form submission

          // Get form data
          const formData = new FormData(this);

          // Send POST request using Axios
          axios.post('/watering/', formData)
              .then(response => {
                  if (response.data.success) {
                      // Handle success
                      alert('Полив начался!');
                  } else {
                      // Handle failure
                      alert('Что то пошло не так!');
                  }
              })
              .catch(error => {
                  console.error('Error:', error);
                  alert('An error occurred while watering.');
              });
        });


    </script>
    <style>
      /* CSS styles */
      

      .tank {
          width: 150px; /* Width of the tank */
          height: 220px; /* Height of the tank */
          border: 3px solid #dad8d8a2;
          border-radius: 10px; /* Border radius for the tank */
          position: relative;
          overflow: hidden; /* Ensure water does not overflow */
          background-color: #eee;
          box-shadow: 0 0 20px rgba(0, 0, 0, 0.3); /* Add shadow to the tank */
      }

      .water {
          background-color: #3498db; /* Blue color for water */
          position: absolute;
          bottom: 0;
          width: 100%;
          border-radius: 0 0 10px 10px; /* Rounded corners only at the bottom */
          transition: height 0.5s; /* Smooth transition for water level changes */
      }

      .water-level {
          position: absolute;
          bottom: 0;
          width: 100%;
          text-align: center;
          color: #fff;
          font-weight: bold;
          padding: 8px;
          text-shadow: 0 2px 2px rgba(0, 0, 0, 0.3); /* Add shadow to the text */
          background-color: rgba(52, 152, 219, 0.8); /* Semi-transparent background color */
          border-radius: 0 0 10px 10px; /* Rounded corners only at the bottom */
      }

      input[type="range"] {
          width: 150px;
          -webkit-appearance: none;
          appearance: none;
          background: linear-gradient(to right, #3498db, #1c49da);
          border-radius: 5px;
          height: 5px;
          outline: none;
          margin: 10px 0;
      }

      input[type="range"]::-webkit-slider-thumb {
          -webkit-appearance: none;
          appearance: none;
          width: 15px;
          height: 15px;
          border-radius: 50%;
          background: #1e8ad1;
          cursor: pointer;
      }
    </style>

    <!-- Core JS -->
    <!-- build:js assets/vendor/js/core.js -->
    <script src="{% static 'admin/vendor/libs/jquery/jquery.js'%}"></script>
    <script src="{% static 'admin/vendor/js/bootstrap.js'%}"></script>

    <!-- endbuild -->
    <script>
      // JavaScript code to dynamically adjust water level
      function setWaterLevel(litres) {
          const water = document.getElementById('water');
          const waterLevelText = document.getElementById('waterLevel');
          const tankHeight = 220; // Height of the tank in pixels
          const tankVolume = 20; // Total volume of the tank in liters
          const waterHeight = (litres / tankVolume) * tankHeight;
          water.style.height = waterHeight/100 + 'px';
          waterLevelText.textContent = litres + ' мл';
      }

      // Initial setup: Set water level to 10 Litres
      setWaterLevel(500);
    </script>
    <!-- Vendors JS -->
    <script src="{% static 'admin/vendor/libs/apex-charts/apexcharts.js'%}"></script>

    <!-- Main JS -->
    <script src="{% static 'admin/vendor/js/menu.js'%}"></script>
    

    <script src="{% static 'admin/vendor/libs/popper/popper.js' %}"></script>
    <!-- Page JS -->
    <script src="{% static 'admin/js/dashboards-analytics.js'%}"></script>
  </body>
</html>
