{% load static %}
<!DOCTYPE html>

<html
  lang="en"
  class="light-style layout-menu-fixed layout-compact"
  dir="ltr"
  data-theme="theme-default"
  data-template="vertical-menu-template-free">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0" />

    <title>Plant SCADA</title>

    <meta name="description" content="" />

    <!-- Favicon -->

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&ampdisplay=swap"
      rel="stylesheet" />

    <link rel="stylesheet" href="{% static 'admin/vendor/fonts/materialdesignicons.css' %}" />


    <!-- Core CSS -->
    <link rel="stylesheet" href="{% static 'admin/vendor/css/core.css' %}" class="template-customizer-core-css" />
    <link rel="stylesheet" href="{% static 'admin/vendor/css/theme-default.css' %}" class="template-customizer-theme-css" />
    <link rel="stylesheet" href="{% static 'admin/css/demo.css' %}" />

    <!-- Helpers -->
    <script src="{% static 'admin/vendor/js/helpers.js' %}"></script>
    <!--! Template customizer & Theme config files MUST be included after core stylesheets and helpers.js in the <head> section -->
    <!--? Config:  Mandatory theme config file contain global vars & default theme options, Set your preferred theme option in this file.  -->
    <script src="{% static 'admin/js/config.js' %}"></script>
  </head>

  <body>
    <!-- Layout wrapper -->
    <div class="layout-wrapper layout-content-navbar">
      <div class="layout-container">
        <!-- Menu -->

        <aside id="layout-menu" class="layout-menu menu-vertical menu bg-menu-theme">
          <div class="app-brand demo">
            <a href="index.html" class="app-brand-link">
              <span class="app-brand-logo demo me-1">
                <span style="color: var(--bs-primary)">
                 
                </span>
              </span>
              <span class="app-brand-text demo menu-text fw-semibold ms-2" style="color:#3ed89d">PLANTS CONTROL</span>
            </a>

            <a href="javascript:void(0);" class="layout-menu-toggle menu-link text-large ms-auto">
              <i class="mdi menu-toggle-icon d-xl-block align-middle mdi-20px"></i>
            </a>
          </div>

          <div class="menu-inner-shadow"></div>

          <ul class="menu-inner py-1">
            <!-- Dashboards -->
            <li class="menu-item active">
              <a href="{% url 'admin-index'%}" class="menu-link">
                <i class="menu-icon tf-icons mdi mdi-view-dashboard-variant"></i>
                <div>Панель</div>
              </a>             
            </li>

            

            <!-- Forms & Tables -->
            <li class="menu-header fw-medium mt-4"><span class="menu-header-text">Растения и Устройства</span></li>
            <!-- Form Validation -->
            <li class="menu-item">
              <a href="{% url 'admin-plants'%}" target="_blank" class="menu-link">
                <i class="menu-icon tf-icons mdi mdi-sprout"></i>
                <div data-i18n="Form Validation">Растения</div>
                <div class="badge bg-label-primary fs-tiny rounded-pill ms-auto">5</div>
              </a>
            </li>
            <!-- Data Tables -->
            <li class="menu-item">
              <a href="#" target="_blank" class="menu-link">
                <i class="menu-icon tf-icons mdi mdi-grid"></i>
                <div data-i18n="Datatables">Устройства</div>
                <div class="badge bg-label-primary fs-tiny rounded-pill ms-auto">5</div>
              </a>
            </li>
            <!-- Misc -->
            <li class="menu-header fw-medium mt-4"><span class="menu-header-text">Создание объекта</span></li>
            <li class="menu-item">
              <a
                href="{% url 'plant-create'%}"
                target="_blank"
                class="menu-link">
                <i class="menu-icon tf-icons mdi mdi-seed-plus-outline"></i>
                <div>Добавить растение</div>
              </a>
            </li>
            <li class="menu-item">
              <a
                href="{% url 'category-create' %}"
                target="_blank"
                class="menu-link">
                <i class="menu-icon tf-icons mdi mdi-plus-box"></i>
                <div>Добавить комнату</div>
              </a>
            </li>
            <li class="menu-item">
              <a
                href="{% url 'responsible-create' %}"
                target="_blank"
                class="menu-link">
                <i class="menu-icon tf-icons mdi mdi-account-plus"></i>
                <div>Добавить ответственного</div>
              </a>
            </li>
          </ul>
        </aside>
        <!-- / Menu -->

        <!-- Layout container -->
        <div class="layout-page">
          <!-- Navbar -->

          <nav
            class="layout-navbar container-xxl navbar navbar-expand-xl navbar-detached align-items-center bg-navbar-theme"
            id="layout-navbar">
            <div class="layout-menu-toggle navbar-nav align-items-xl-center me-3 me-xl-0 d-xl-none">
              <a class="nav-item nav-link px-0 me-xl-4" href="javascript:void(0)">
                <i class="mdi mdi-menu mdi-24px"></i>
              </a>
            </div>

            <div class="navbar-nav-right d-flex align-items-center" id="navbar-collapse">
              <!-- Search -->
              <div class="navbar-nav align-items-center">
                <div class="nav-item d-flex align-items-center">
                  <i class="mdi mdi-magnify mdi-24px lh-0"></i>
                  <input
                    type="text"
                    class="form-control border-0 shadow-none bg-body"
                    placeholder="Поиск..."
                    aria-label="Поиск..." />
                </div>
              </div>
              <!-- /Search -->

              <ul class="navbar-nav flex-row align-items-center ms-auto">
                
                <!-- User -->
                <li class="nav-item navbar-dropdown dropdown-user dropdown">
                  <a
                    class="nav-link dropdown-toggle hide-arrow p-0"
                    href="javascript:void(0);"
                    data-bs-toggle="dropdown">
                    <div class="avatar avatar-online">
                      <img src="{% static 'admin/img/avatars/face.jpg' %}" alt class="w-px-40 h-auto rounded-circle" />
                    </div>
                  </a>
                  <ul class="dropdown-menu dropdown-menu-end mt-3 py-2">
                    <li>
                      <a class="dropdown-item pb-2 mb-1" href="#">
                        <div class="d-flex align-items-center">
                          <div class="flex-shrink-0 me-2 pe-1">
                            <div class="avatar avatar-online">
                              <img src="{% static 'admin/img/avatars/face.jpg'%}" alt class="w-px-40 h-auto rounded-circle" />
                            </div>
                          </div>
                          <div class="flex-grow-1">
                            <h6 class="mb-0">Администратор</h6>
                            <small class="text-muted">Админ</small>
                          </div>
                        </div>
                      </a>
                    </li>
                    <li>
                      <div class="dropdown-divider my-1"></div>
                    </li>
                    <li>
                      <a class="dropdown-item" href="#">
                        <i class="mdi mdi-account-outline me-1 mdi-20px"></i>
                        <span class="align-middle">Мой профиль</span>
                      </a>
                    </li>
                    <li>
                      <a class="dropdown-item" href="#">
                        <i class="mdi mdi-cog-outline me-1 mdi-20px"></i>
                        <span class="align-middle">Настройки</span>
                      </a>
                    </li>
                    <li>
                      <div class="dropdown-divider my-1"></div>
                    </li>
                    <li>
                      <a class="dropdown-item" href="javascript:void(0);">
                        <i class="mdi mdi-power me-1 mdi-20px"></i>
                        <span class="align-middle">Выйти</span>
                      </a>
                    </li>
                  </ul>
                </li>
                <!--/ User -->
              </ul>
            </div>
          </nav>

          <!-- / Navbar -->

          <!-- Content wrapper -->
          <div class="content-wrapper">
            
            <!-- Plant -->
            <div class="container-xxl flex-grow-1 container-p-y">              
              <div class="row gy-4">
                <!-- Total Earnings -->
                {% for m in queryset %}
                <div class="col-xl-4 col-md-6">
                  <div class="card">
                    <div class="card-header d-flex align-items-center justify-content-between">
                      <h3 class="card-title m-0 me-2" style="color:#0fb462">{{ m.plant_name }}</h3>
                      <div class="dropdown">
                        <button
                          class="btn p-0"
                          type="button"
                          id="totalEarnings"
                          data-bs-toggle="dropdown"
                          aria-haspopup="true"
                          aria-expanded="false">
                          <i class="mdi mdi-dots-vertical mdi-24px"></i>
                        </button>
                        <div class="dropdown-menu dropdown-menu-end" aria-labelledby="totalEarnings">
                          <a class="dropdown-item" href="javascript:void(0);">Обновить</a>
                          <a class="dropdown-item" href="javascript:void(0);">Изменить</a>
                          <a class="dropdown-item" href="javascript:void(0);">Удалить</a>
                        </div>
                      </div>
                    </div>

                    <div class="card-body">
                      <div class="mb-3">
                          <div class="d-flex align-items-center">
                            <h2 class="mb-0" style="color:rgba(11, 159, 204, 0.95);">
                              {{ m.soil_value }}%
                            </h2>
                              <span class="text-success ms-2 fw-medium">
                                  <i class="mdi mdi-alarm-check mdi-24px" style="color:#dfae0d"></i>
                                  <small style="color:#dfae0d">60 мин.</small>
                              </span>
                          </div>
                          <small class="mt-1">Максимальный объем воды - {{ m.capacity }} мл </small>
                      </div>
                      <div class="d-flex mb-4 pb-md-2 align-items-center">
                          <div class="mb-2">
                              <canvas id="soilChart{{ m.plant_num }}" width="250" height="250" data-soil-value="{{ m.soil_value }}"></canvas>
                          </div>
                          <div class="mb-2">
                            <form id="controlForm">
                              <div class="container">
                                  <a href="#" class="device relay active">Сеснсор</a>
                                  <a href="#" class="device pump">Насос</a>
                              </div>
                                <input type="hidden" id="relayState" name="relayState" value="true">
                                <input type="hidden" id="pumpState" name="pumpState" value="false">

                            </form>
                          </div>
                      </div>                      
                    </div>                                
                  </div>
                </div>
                {% endfor %}

              </div>
            </div>
            <!-- / Plant -->
            

            <div class="content-backdrop fade"></div>
          </div>
          <!-- Content wrapper -->
        </div>
        <!-- / Layout page -->
      </div>

      <!-- Overlay -->
      <div class="layout-overlay layout-menu-toggle"></div>
    </div>
    <!-- / Layout wrapper -->
    <style>    
      .device {
        width: 100px;
        height: 100px;
        border: 2px solid #333; /* Adjust border width */
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        margin: 10px;
        text-decoration: none; /* Remove default underline */
        color: rgb(255, 255, 255); /* Text color */
        font-weight: bold; /* Bold font */
        font-size: 12px; /* Larger font size */
        letter-spacing: 0.5px; /* Increased letter spacing */
        text-transform: uppercase; /* Uppercase text */
        transition: background-color 0.3s; /* Smooth transition */
      }
      .device:hover {
        background-color: linear-gradient(270deg, #3ceeaa 0%, #0fb676 100%); /* Light gray on hover */
        color: white;
      }

      .relay {
        border-color: white; /* CornflowerBlue */
        background-color: #ff0000; /* SkyBlue */

      }
      .relay.active {
        border-color: white; 
        background-color: #0ddf76; /* SkyBlue */

      }
      .pump {
        border-color: white; 
        background-color: #ff0000; /* Red */

      }
      .pump:hover {
        border-color: white; 
        background-color: #ff0000c0; /* Red */

      }
      .pump.active {
        background-color:#0ddf76; /* Gradient green */
        border-color: white; /* OrangeRed */
      }
      .pump.active:hover {
        background-color:#0ddf76cc; /* Gradient green */
        border-color: white; /* OrangeRed */
      }
    </style>
    <script>
      document.getElementById('controlForm').addEventListener('submit', function(event) {
          event.preventDefault();  // Prevent default form submission

          // Get form data
          const formData = new FormData(this);

          // Send POST request using Axios
          axios.post('/watering/', formData)
              .then(response => {
                  if (response.data.success) {
                      // Handle success
                      alert('Watering successful!');
                  } else {
                      // Handle failure
                      alert('Watering failed!');
                  }
              })
              .catch(error => {
                  console.error('Error:', error);
                  alert('An error occurred while watering.');
              });
        });


        // Update power and WiFi status
        const relayIndicator = document.querySelector('.relay');
        const pumpIndicator = document.querySelector('.pump');

        // Simulate changing power and WiFi status (for demonstration purposes)
        setInterval(() => {
            pumpIndicator.style.backgroundColor = Math.random() < 0.5 ? '#0ddf76' : ' #ff0000';
            relayIndicator.style.backgroundColor = Math.random() < 0.5 ? '#0ddf76' : '#dfae0d';
        }, 3000); // Update every 1 seconds

    </script>
    

    <script src="{% static 'chart.js'%}"></script>
    
    
  
    <!-- Core JS -->
    <!-- build:js assets/vendor/js/core.js -->
    <script src="{% static 'admin/vendor/libs/jquery/jquery.js'%}"></script>
    <script src="{% static 'admin/vendor/js/bootstrap.js'%}"></script>

    <!-- endbuild -->
    <script content="text/javascript" src="{%static 'main.js'%}"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

    <!-- Vendors JS -->
    <script src="{% static 'admin/vendor/libs/apex-charts/apexcharts.js'%}"></script>

    <!-- Main JS -->
    <script src="{% static 'admin/vendor/js/menu.js'%}"></script>
    

    <script src="{% static 'admin/vendor/libs/popper/popper.js' %}"></script>
    <!-- Page JS -->
    <script src="{% static 'admin/js/dashboards-analytics.js'%}"></script>
  </body>
</html>
